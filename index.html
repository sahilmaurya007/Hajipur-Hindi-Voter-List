<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡§µ‡§æ‡§∞‡•ç‡§°-‡§µ‡§æ‡§∞ ‡§Æ‡§§‡§¶‡§æ‡§§‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£</title>
  <style>
    body { font-family: 'Noto Sans Devanagari', Arial, sans-serif; padding: 20px; max-width: 800px; margin: auto; background: #f5f7fa; }
    h1 { text-align: center; color: #2c3e50; margin-bottom: 20px; }
    label { display: block; margin-top: 15px; font-weight: bold; }
    select, input { padding: 10px; margin: 8px 0; font-size: 16px; width: 100%; max-width: 250px; }
    button { padding: 10px 20px; font-size: 16px; background: #3498db; color: white; border: none; cursor: pointer; margin-top: 10px; }
    button:hover { background: #2980b9; }
    #result { margin-top: 20px; padding: 15px; background: white; border-radius: 8px; display: none; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .info { background: #e8f4fc; padding: 10px; border-radius: 5px; margin: 10px 0; }
    .error { color: #e74c3c; }
    .success { color: #27ae60; }
    .names { margin-top: 12px; line-height: 1.5; background: #f9f9f9; padding: 10px; border-radius: 5px; }
  </style>
</head>
<body>
  <h1>üèòÔ∏è ‡§µ‡§æ‡§∞‡•ç‡§°-‡§µ‡§æ‡§∞ ‡§Æ‡§§‡§¶‡§æ‡§§‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£</h1>

  <!-- Step 1: Select Ward -->
  <label for="wardSelect">1. ‡§µ‡§æ‡§∞‡•ç‡§° ‡§ö‡•Å‡§®‡•á‡§Ç:</label>
  <select id="wardSelect">
    <option value="">-- ‡§µ‡§æ‡§∞‡•ç‡§° ‡§ö‡•Å‡§®‡•á‡§Ç --</option>
  </select>

  <!-- Step 2: Show Total Houses (auto-filled after ward selection) -->
  <div id="houseSummary" class="info" style="display: none;">
    ‡§á‡§∏ ‡§µ‡§æ‡§∞‡•ç‡§° ‡§Æ‡•á‡§Ç ‡§ï‡•Å‡§≤ <strong id="totalHouses">0</strong> ‡§Æ‡§ï‡§æ‡§® ‡§π‡•à‡§Ç‡•§
  </div>

  <!-- Step 3: Select House -->
  <label for="houseSelect">2. ‡§Æ‡§ï‡§æ‡§® ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç:</label>
  <select id="houseSelect" disabled>
    <option value="">-- ‡§Æ‡§ï‡§æ‡§® ‡§ö‡•Å‡§®‡•á‡§Ç --</option>
  </select>

  <!-- Show Button -->
  <button onclick="showVoters()">3. ‡§Æ‡§§‡§¶‡§æ‡§§‡§æ ‡§¶‡•á‡§ñ‡•á‡§Ç</button>

  <!-- Result -->
  <div id="result"></div>

  <script>
    let allData = [];
    const wardSelect = document.getElementById('wardSelect');
    const houseSelect = document.getElementById('houseSelect');
    const houseSummary = document.getElementById('houseSummary');
    const totalHousesEl = document.getElementById('totalHouses');
    const resultDiv = document.getElementById('result');

    // Load data
    fetch('voters.json')
      .then(response => response.json())
      .then(data => {
        allData = data;
        const wards = [...new Set(data.map(d => d.Ward))].sort((a,b) => a-b);
        wards.forEach(w => {
          const opt = document.createElement('option');
          opt.value = w;
          opt.textContent = `‡§µ‡§æ‡§∞‡•ç‡§° ${w}`;
          wardSelect.appendChild(opt);
        });
      })
      .catch(err => {
        resultDiv.innerHTML = '<p class="error">‚ùå ‡§Æ‡§§‡§¶‡§æ‡§§‡§æ ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§´‡§≤‡•§</p>';
        resultDiv.style.display = 'block';
      });

    // When ward is selected
    wardSelect.addEventListener('change', () => {
      const ward = parseInt(wardSelect.value);
      if (!ward) {
        houseSummary.style.display = 'none';
        houseSelect.disabled = true;
        houseSelect.innerHTML = '<option value="">-- ‡§Æ‡§ï‡§æ‡§® ‡§ö‡•Å‡§®‡•á‡§Ç --</option>';
        return;
      }

      // Get unique houses in this ward
      const houses = [...new Set(allData.filter(d => d.Ward === ward).map(d => d.H_No))].sort((a,b) => a-b);
      totalHousesEl.textContent = houses.length;
      houseSummary.style.display = 'block';

      // Populate house dropdown
      houseSelect.innerHTML = '<option value="">-- ‡§Æ‡§ï‡§æ‡§® ‡§ö‡•Å‡§®‡•á‡§Ç --</option>';
      houses.forEach(h => {
        const opt = document.createElement('option');
        opt.value = h;
        opt.textContent = `‡§Æ‡§ï‡§æ‡§® ${h}`;
        houseSelect.appendChild(opt);
      });
      houseSelect.disabled = false;
    });

    // Show voters
    function showVoters() {
      const ward = parseInt(wardSelect.value);
      const house = parseInt(houseSelect.value);

      if (!ward || !house) {
        resultDiv.innerHTML = '<p class="error">‚ö†Ô∏è ‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡§æ‡§∞‡•ç‡§° ‡§î‡§∞ ‡§Æ‡§ï‡§æ‡§® ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§ö‡•Å‡§®‡•á‡§Ç‡•§</p>';
        resultDiv.style.display = 'block';
        return;
      }

      const voters = allData.filter(d => d.Ward === ward && d.H_No === house);
      if (voters.length === 0) {
        resultDiv.innerHTML = `<p class="error">‚ùå ‡§µ‡§æ‡§∞‡•ç‡§° ${ward}, ‡§Æ‡§ï‡§æ‡§® ${house} ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§Æ‡§§‡§¶‡§æ‡§§‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§</p>`;
      } else {
        const names = voters.map(v => v.Voter_Name).join(', ');
        resultDiv.innerHTML = `
          <p class="success">‚úÖ ‡§µ‡§æ‡§∞‡•ç‡§° ${ward}, ‡§Æ‡§ï‡§æ‡§® ${house}</p>
          <p><strong>‡§ï‡•Å‡§≤ ‡§Æ‡§§‡§¶‡§æ‡§§‡§æ:</strong> ${voters.length}</p>
          <p class="names"><strong>‡§Æ‡§§‡§¶‡§æ‡§§‡§æ ‡§®‡§æ‡§Æ:</strong><br>${names}</p>
        `;
      }
      resultDiv.style.display = 'block';
    }
  </script>
</body>
</html>
